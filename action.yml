name: 'Wodby deploy'
description: 'Handles a deploy on a Wodby app instance'
branding:
  icon: arrow-up-circle
  color: blue
inputs:
  uuid:
    description: 'Instance UUID (provided by Wodby)'
    required: true
  path:
    description: 'Base path to build'
    required: true
    default: './'
  dockerfile:
    description: 'Path to a custom Dockerfile (Will replace one provided by Wodby)'
    required: false
runs:
  using: "composite"
  steps:
  -
    run: wget -qO- https://api.wodby.com/api/v1/get/cli | sh
    shell: bash
  -
    run: wodby ci init ${{ inputs.uuid }}
    shell: bash
  -
    if: ${{ inputs.dockerfile }}
    run: wodby ci build --from ${{ inputs.path }} --dockerfile ${{ inputs.dockerfile }}
    shell: bash
  -
    if: ${{ not inputs.dockerfile }}
    run: wodby ci build --from ${{ inputs.path }}
    shell: bash
  -
    run: wodby ci release
    shell: bash
  -
    run: wodby ci deploy
    shell: bash
